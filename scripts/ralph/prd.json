{
  "branchName": "ralph/multi-process-support",
  "userStories": [
    {
      "id": "MP-001",
      "title": "Refactor NativeBridge to track multiple processes via Map<String, Process>",
      "acceptanceCriteria": [
        "NativeBridge uses Map<String, Process> instead of single prootProcess field",
        "launchProot accepts sessionId parameter and stores process in map",
        "killProot accepts sessionId to kill specific process",
        "isProotRunning accepts sessionId to check specific process",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Critical for concurrent process execution. See NativeBridge.kt:49"
    },
    {
      "id": "MP-002",
      "title": "Return actual OS PID from launchProot and track in session",
      "acceptanceCriteria": [
        "launchProot returns ProcessHandle or wrapper with real PID",
        "UbuntuSessionImpl stores actual PID instead of timestamp",
        "getPid(sessionId) method returns real process ID",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Required for proper signal handling. See UbuntuSessionManagerImpl.kt:220"
    },
    {
      "id": "MP-003",
      "title": "Fix stream reader race condition in launchProot",
      "acceptanceCriteria": [
        "stdout/stderr reader threads complete before returning result",
        "Fast commands (<100ms) capture full output",
        "Use proper thread synchronization instead of join(500)",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Current code loses output for fast commands. See NativeBridge.kt:217-218"
    },
    {
      "id": "MP-004",
      "title": "Add configurable timeout support for long-running operations",
      "acceptanceCriteria": [
        "exec() accepts optional timeout parameter with default 300s",
        "launchProot respects configurable timeout",
        "Timeout of 0 means no timeout (wait indefinitely)",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Claude Code tasks often exceed 60s current max"
    },
    {
      "id": "MP-005",
      "title": "Add stdin support for interactive command execution",
      "acceptanceCriteria": [
        "New execInteractive() method accepts stdin input",
        "Can pipe input to running proot process",
        "Returns ProcessResult with stdout/stderr as before",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Needed for interactive prompts and REPL sessions"
    },
    {
      "id": "MP-006",
      "title": "Implement clean session shutdown with child process cleanup",
      "acceptanceCriteria": [
        "stop() kills all child processes spawned by session",
        "Uses process group or pkill by PPID pattern",
        "No orphan processes left after session stop",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 6,
      "passes": false,
      "notes": "nohup services currently leave orphans on session stop"
    },
    {
      "id": "US-001",
      "title": "Fix ProcessResult visibility so session/native APIs compile",
      "acceptanceCriteria": [
        "ProcessResult is accessible where referenced",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 1,
      "passes": true,
      "notes": "See BUILD_STATUS.md item 1"
    },
    {
      "id": "US-002",
      "title": "Resolve getSession override conflict in UbuntuSessionManagerImpl",
      "acceptanceCriteria": [
        "No override conflict errors",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 2,
      "passes": true,
      "notes": "See BUILD_STATUS.md item 2"
    },
    {
      "id": "US-003",
      "title": "Fix SessionStateData vs SessionState mismatches in UbuntuSessionManagerImpl",
      "acceptanceCriteria": [
        "Correct toDomain/toData conversions used",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 3,
      "passes": true,
      "notes": "See BUILD_STATUS.md item 3"
    },
    {
      "id": "US-004",
      "title": "Fix OkHttp API usage in RootfsDownloadService",
      "acceptanceCriteria": [
        "OkHttp 4.12 APIs used correctly",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 4,
      "passes": true,
      "notes": "See BUILD_STATUS.md item 4"
    },
    {
      "id": "US-005",
      "title": "Replace missing icon references in foreground services",
      "acceptanceCriteria": [
        "No missing resource errors",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 5,
      "passes": true,
      "notes": "See BUILD_STATUS.md item 5"
    },
    {
      "id": "US-006",
      "title": "Fix missing imports (Flow asStateFlow, Material Icons) and DataStore firstOrNull usage",
      "acceptanceCriteria": [
        "No missing import / API errors remain",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 6,
      "passes": true,
      "notes": "See BUILD_STATUS.md items 6-8"
    },
    {
      "id": "US-007",
      "title": "Add initial Devbox sharing data model (routes + share state) without breaking session persistence",
      "acceptanceCriteria": [
        "A persisted model exists for devbox share state (even if stubbed)",
        "No changes break existing session persistence",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Keep story small: model + repository only"
    },
    {
      "id": "US-008",
      "title": "Add UI affordance to show a shareable URL + QR code on DesktopScreen (stub URL)",
      "acceptanceCriteria": [
        "DesktopScreen shows a share section gated behind a button/toggle",
        "A QR code can be generated for the stub URL",
        "./gradlew :app:assembleDebug succeeds"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Do not implement networking yet; just UX + QR"
    }
  ]
}
